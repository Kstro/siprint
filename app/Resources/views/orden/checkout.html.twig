{% extends ':Layout:layout.html.twig' %}

{% block section %}
    Checkout
{% endblock %}

{% block section2 %}
    Checkout
{% endblock %}

{% block sidebar %}
    {% include ':Layout:accountsidebar.html.twig'%}
        <div class="category-left-banner">
            <a href="#" title="category left banner">
                {% block img_prom %}
                    {% if promotion['promotion'] %}
                        <img src="{{ asset('Photos/promotions/')}}{{ promotion['promotion'].imagen }}" alt="{{ promotion['promotion'].nombre }}">
                    {% else %}    
                        <img src="http://placehold.it/263x263" alt="promotions">
                    {% endif %}    
                {% endblock %}
            </a>
        </div>
    </aside>
{% endblock %}

{% block contenido %}
    <style>
        #formCheckout span{
            display:none;
        }
        
        #formCheckout label{
            display:none;
        }
        
        #payment-submit{
            float: right;
            background: #25BCE9;
            color: #FFF;
            border:0px;
            border-radius: 0px;
            margin-bottom: 10px;
        }

        #payment-submit:hover{
            opacity: 0.7;

        }
        .form-row{
            width:100%;
        }
            
        #labelMonto{
            display: block;
        }
        .error{
            border:1px solid #F00;
            /*-webkit-box-shadow: 0px 0px 2px 0px rgba(255, 0, 0, 1);
            -moz-box-shadow:    0px 0px 2px 0px rgba(255, 0, 0, 1);
            box-shadow:         0px 0px 2px 0px rgba(255, 0, 0, 1);
            */
        }
        
        #promoCode{
            border-radius: 0px;
        }
    </style>
    <div id="resultado"></div>
    <div class="acc-title lg">
        <div class="col-md-5 pull-left">
            <h3 class="" style="color:#FFF;">Checkout</h3>
        </div>        
    </div>
    
    <div class="form-edit-info" style="padding-top: 20px;">
        <div class="col-md-5 text-right" style="margin-bottom: 45px;"><label>Shipping address: </label> </div>
        <div class="col-md-6" style="margin-bottom: 45px;">
            <select id="selectDirecciones" class="form-control input-sm">
                <option value="0">New address...</option>
            {% for dir in direcciones %}
                <option value="{{dir.id}}"> {{dir.linea1}}, {{dir.linea2}}, {{dir.city}} {{dir.country}}</option>
            {% endfor %}
            </select>
        </div>        
        <div class="clearfix"></div>
        <div class="col-md-12">
            <form name="payment-form" id="payment-form" method="post" action="http://localhost/siprint/web/app_dev.php/payment/stripe/execute" style="margin-top: -25px;">
                <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Full Name:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_name" name="direccion[name]" maxlength="200" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Phone Number:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_phoneNumber" name="direccion[phoneNumber]" maxlength="25" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Line 1:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_linea1" name="direccion[linea1]" maxlength="150" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Line 2:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_linea2" name="direccion[linea2]" maxlength="150" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * City:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_city" name="direccion[city]" maxlength="150" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * State / Province / Region:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <select id="direccion_state" name="direccion[state]" maxlength="150" class="form-control input-sm" type="text">
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Country:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <select id="direccion_country" name="direccion[country]" maxlength="100" class="form-control input-sm" type="text">
                            <option value="United States"> United States</option>
                        </select>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Zip Code:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_zipCode" name="direccion[zipCode]" maxlength="20" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        Security Access Code:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_securityAccessCode" name="direccion[securityAccessCode]" maxlength="255" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        Save address:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="opcionguardaraddress" name="direccion[opcionguardar]" class="form-control" value="1" type="checkbox">
                    </div>
                    <div class="clearfix"></div>
                </form>
            </div>
            <div class="clearfix"></div>
            
            <div class="col-md-5 text-right" style="margin-top:20px;margin-bottom:20px;"><label>Payment method: </label> </div>
            <div class="col-md-6" style="margin-top:20px;margin-bottom:20px;">
                <select id="selectTarjetas" class="form-control input-sm">
                    <option value="0">New card...</option>
                {% for tar in tarjetas %}
                    <option value="{{tar.id}}">Card ending in:{% set numerotar = tar.numero|length %}{% for i in 0..(numerotar-5)%}{% endfor %}{{ tar.numero|slice(numerotar-4) }},{{tar.nombre}}</option>
                {% endfor %}
                </select>
            </div>                    
            <div class="clearfix"></div>
            
            <div>
                <form name="payment-form" id="payment-form" method="post" action="http://localhost/siprint/web/app_dev.php/payment/stripe/execute">
                    <div id="formnewcard" class="row" style="margin: 10px 0;">
                        <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                            * Number:
                        </div>
                        <div class="col-md-6" style="margin-bottom: 4px;">
                            <input id="tarjeta_numero" name="tarjeta[numero]" maxlength="20" class="form-control input-sm" type="text">
                        </div>
                        <div class="clearfix"></div>
                        <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                            * Name:
                        </div>
                        <div class="col-md-6" style="margin-bottom: 4px;">
                            <input id="tarjeta_nombre" name="tarjeta[nombre]" maxlength="200" class="form-control input-sm" type="text">
                        </div>
                        <div class="clearfix"></div>
                        <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                            * CVC:
                        </div>
                        <div class="col-md-6" style="margin-bottom: 4px;">
                            <input id="tarjeta_cvc" name="tarjeta[cvc]" required="required" maxlength="4" class="form-control input-sm" type="text">
                        </div>
                        <div class="clearfix"></div>
                        <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                            * Expiration date:
                        </div>
                        <div class="col-md-6" style="margin-bottom: 4px;">
                            <input readonly="readonly" id="tarjeta_expiracion" name="tarjeta[expiracion]" class="form-control input-sm calZebra" type="text">
                        </div>
                        <div class="clearfix" style=""></div>

                        <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                            Save payment method:
                        </div>
                        <div class="col-md-6" style="margin-bottom: 4px;">
                            <input id="opcionguardarcard" name="tarjeta[payment]" class="form-control" value="1" type="checkbox">
                        </div>
                        <div class="clearfix"></div>

                        <script>
                            $(document).ready(function(){
                                $('.calZebra').Zebra_DatePicker({
                                    format: 'm-Y',
                                    show_clear_date:false,
                                    direccion: 1,
                                    show_select_today: "Today",
                                    show_icon:false,
                                    onSelect: function(){
                                        var expiracion = $('#tarjeta_expiracion').val();
                                        //alert(expiracion);
                                        var fecha = expiracion.split("-");
                                        //alert(fecha[0]);
                                        var dia=0;
                                        if(fecha[0]<10){
                                            dia= parseInt(fecha[0]);
                                            $('#stripe_view_credit_cart_expiration_month').val(dia);
                                        }
                                        else{
                                            $('#stripe_view_credit_cart_expiration_month').val(fecha[0]);
                                        }
                                        $('#stripe_view_credit_cart_expiration_year').val(fecha[1]);
                                    },
                                    //offset: [0,0]
                                });
                            });
                        </script>

                    </div>
                    <div class="col-md-5 text-right text-bold" style="margin-bottom: 4px; margin-top: 15px;">
                        Total order $:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px; margin-top: 15px;">
                        <input id="total" readonly value="{{totalOrden|number_format(2,'.',',')}}" name="amount[amount]" class="form-control" type="text">
                    </div>
                    <div class="clearfix"></div>
                    
                    <div class="col-md-5 text-right text-bold" style="margin-bottom: 4px;">
                        Promo code:
                    </div>
                    <div class="col-md-4" style="margin-bottom: 4px;">
                        <input id="promo" class="form-control" type="text">
                    </div>
                    <div class="col-md-2" style="margin-bottom: 20px;">
                        <button id="promoCode" class="btn btn-success" >
                            Apply
                        </button>
                    </div>
                    <div class="clearfix"></div>
                    
                    <div class="col-md-12 col-sm-12" id="capaError" style="color:red; visibility:hidden;"></div>
                    <div class="clearfix"></div>
                </form>
            </div> 
            <div id="formCheckout" class="col-md-12 pull-right">
                {% block content %}
                    <div class="payment-wrapper">
                        {{ stripe_render() }}
                    </div>
                {% endblock content %}

                {% block foot_script %}
                    {{ parent() }}
        {#            {{ stripe_scripts() }}#}
                {% endblock foot_script %}
            </div>
        </div>
    {#</div>#}
    
    {#<div class="container-fluid" style="margin-top:10px;">        #}
        {#<div class="col-md-5"><label>Shipping address: </label> </div>
        <div class="col-md-6">
            <select id="selectDirecciones" class="form-control input-sm">
                <option value="0">New address...</option>
            {% for dir in direcciones %}
                <option value="{{dir.id}}"> {{dir.linea1}}, {{dir.linea2}}, {{dir.city}} {{dir.country}}</option>
            {% endfor %}
            </select>
        </div>
        
        <div class="clearfix"></div>#}
        {#<div class="col-md-12" style="height:400px;">#}
              
            {#<form name="payment-form" id="payment-form" method="post" action="http://localhost/siprint/web/app_dev.php/payment/stripe/execute" style="margin-top: -25px;">
                <div id="formnewaddress" class="row" style="margin: 50px 0;">#}
                    {#<div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Full Name:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_name" name="direccion[name]" maxlength="200" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Phone Number:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_phoneNumber" name="direccion[phoneNumber]" maxlength="25" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Line 1:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_linea1" name="direccion[linea1]" maxlength="150" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Line 2:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_linea2" name="direccion[linea2]" maxlength="150" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * City:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_city" name="direccion[city]" maxlength="150" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * State / Province / Region:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <select id="direccion_state" name="direccion[state]" maxlength="150" class="form-control input-sm" type="text">
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Country:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <select id="direccion_country" name="direccion[country]" maxlength="100" class="form-control input-sm" type="text">
                            <option value="United States"> United States</option>
                        </select>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Zip Code:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_zipCode" name="direccion[zipCode]" maxlength="20" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        Security Access Code:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="direccion_securityAccessCode" name="direccion[securityAccessCode]" maxlength="255" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        Save address:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="opcionguardaraddress" name="direccion[opcionguardar]" class="form-control" value="1" type="checkbox">
                    </div>
                    <div class="clearfix"></div>


                </div>#}
            {#</form>    
    </div>#}
        
        {#<div class="clearfix"></div>#}
        
            {#<div class="col-md-5" style="margin-top:20px;margin-bottom:20px;"><label>Payment method: </label> </div>
            <div class="col-md-6" style="margin-top:20px;margin-bottom:20px;">
                <select id="selectTarjetas" class="form-control input-sm">
                    <option value="0">New card...</option>
                {% for tar in tarjetas %}
                    <option value="{{tar.id}}">Card ending in:{% set numerotar = tar.numero|length %}{% for i in 0..(numerotar-5)%}{% endfor %}{{ tar.numero|slice(numerotar-4) }},{{tar.nombre}}</option>
                {% endfor %}
                </select>
            </div>
        
            
            <div class="clearfix"></div>#}
            {#<div>
                <form name="payment-form" id="payment-form" method="post" action="http://localhost/siprint/web/app_dev.php/payment/stripe/execute">

                <div id="formnewcard" class="row" style="margin: 10px 0;">
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Number:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="tarjeta_numero" name="tarjeta[numero]" maxlength="20" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Name:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="tarjeta_nombre" name="tarjeta[nombre]" maxlength="200" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * CVC:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="tarjeta_cvc" name="tarjeta[cvc]" required="required" maxlength="4" class="form-control input-sm" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        * Expiration date:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input readonly="readonly" id="tarjeta_expiracion" name="tarjeta[expiracion]" class="form-control input-sm calZebra" type="text">
                    </div>
                    <div class="clearfix" style=""></div>
                    
                    <div class="col-md-5 text-right" style="margin-bottom: 4px;">
                        Save payment method:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="opcionguardarcard" name="tarjeta[payment]" class="form-control" value="1" type="checkbox">
                    </div>
                    <div class="clearfix"></div>
                    
                    
                    <script>
                        $(document).ready(function(){
                            $('.calZebra').Zebra_DatePicker({
                                format: 'm-Y',
                                show_clear_date:false,
                                direccion: 1,
                                show_select_today: "Today",
                                show_icon:false,
                                onSelect: function(){
                                    var expiracion = $('#tarjeta_expiracion').val();
                                    //alert(expiracion);
                                    var fecha = expiracion.split("-");
                                    //alert(fecha[0]);
                                    var dia=0;
                                    if(fecha[0]<10){
                                        dia= parseInt(fecha[0]);
                                        $('#stripe_view_credit_cart_expiration_month').val(dia);
                                    }
                                    else{
                                        $('#stripe_view_credit_cart_expiration_month').val(fecha[0]);
                                    }
                                    $('#stripe_view_credit_cart_expiration_year').val(fecha[1]);
                                },
                                //offset: [0,0]
                            });
                        });
                    </script>

                </div>
                    <div class="col-md-5 text-right text-bold" style="margin-bottom: 4px;">
                        Total order $:
                    </div>
                    <div class="col-md-6" style="margin-bottom: 4px;">
                        <input id="total" readonly value="{{totalOrden|number_format(2,'.',',')}}" name="amount[amount]" class="form-control" type="text">
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-5 text-right text-bold" style="margin-bottom: 4px;">
                        Promo code:
                    </div>
                    <div class="col-md-4" style="margin-bottom: 4px;">
                        <input id="promo" class="form-control" type="text">
                    </div>
                    <div class="col-md-2" style="margin-bottom: 20px;">
                        <button id="promoCode" class="btn btn-success" >
                            Apply
                        </button>
                    </div>
                    <div class="clearfix"></div>
                    <div class="col-md-12 col-sm-12" id="capaError" style="color:red; visibility:hidden;"></div>
                    <div class="clearfix"></div>
            </form>
        </div>    #}
        {#</div>#}
        {#<div id="formCheckout" class="col-md-12 pull-right">
            {% block content %}
                <div class="payment-wrapper">
                    {{ stripe_render() }}
                </div>
            {% endblock content %}

            {% block foot_script %}
                {{ parent() }}
               {{ stripe_scripts() }}
            {% endblock foot_script %}
        </div>#}
        
        
    {#</div>#}
    
{#    <script src="http://code.jquery.com/jquery-1.11.3.js"></script>#}
    
    
    
{#
<form action="http://localhost/sistemaimpresion/web/app_dev.php/payment/stripe/execute" method="POST">
  <script
    src="https://checkout.stripe.com/checkout.js" class="stripe-button"
    data-key="pk_test_5FGIS4dcjWSR0X87vQO744MF"
    data-amount="{{monto}}"
    data-name="Demo Site"
    data-description="2 widgets (${{(monto/100)|number_format(2, '.', ',') }})"
    data-image="/128x128.png"
    data-locale="auto">
  </script>
</form>
#}


{#<script src="http://code.jquery.com/jquery-1.11.3.js"></script>#}
{#<script src="https://checkout.stripe.com/checkout.js"></script>

<button id="customButton">Purchase</button>

<script>
  var handler = StripeCheckout.configure({
    key: 'pk_test_5FGIS4dcjWSR0X87vQO744MF',
    image: '/img/documentation/checkout/marketplace.png',
    locale: 'auto',
    token: function(token) {
      // Use the token to create the charge with a server-side script.
      // You can access the token ID with `token.id`
    }
  });

  $('#customButton').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      name: 'Demo Site',
      description: '2 widgets',
      amount: 2000
    });
    e.preventDefault();
  });

  // Close Checkout on page navigation
  $(window).on('popstate', function() {
    handler.close();
  });
</script>

#}
{% endblock %}

{% block javascripts_step %}
    {{parent()}}
    <script>
        $(document).ready(function () {  
            $('#direccion_state').select2();
            $('#direccion_country').select2();
            $('#selectDirecciones').select2();
            $('#selectTarjetas').select2();
            
            $(document).on('change','#selectTarjetas', function(){
                console.log("cambio selectTarjetas");

                direccionId= $('#selectDirecciones').val();   
                tarjetaId= $('#selectTarjetas').val();
                console.log(direccionId + '-' + tarjetaId);
                buscar(direccionId,tarjetaId);
            });
            
            $(document).on('change','#selectDirecciones', function(){
                console.log("cambio selectDirecciones");

                direccionId= $('#selectDirecciones').val();
                tarjetaId= $('#selectTarjetas').val();

                console.log(direccionId + '-' + tarjetaId)
                buscar(direccionId,tarjetaId);
            });
        });
        
        function buscar(direccionId,tarjetaId){

            $.post( "{{path('get_pago')}}", { direccionId:direccionId,tarjetaId: tarjetaId }, function( data ) {
                var par = new Array();
                par = data.query;

                            // Si la plantilla contiene campos
                if(data.numero !== 0) {
                                //alert('0');
                    $('#stripe_view_credit_cart').val(data.numero);
                    $('#stripe_view_credit_cart_security').val(data.cvc);
                    $('#stripe_view_credit_cart_expiration_month').val(parseInt(data.dia));
                    $('#stripe_view_credit_cart_expiration_year').val(data.anio);
    {#                            $(link).parent().parent().parent().parent().remove();#}
    {#                            $(link).parent().parent().parent().parent().css('opacity','0.7');#}
                }
                else{
                                //alert('1');
                    //$('#totalOrden').html(totalAnterior);
                    //$(link).html(mas);
                }
            }, "json");
        }
    </script>
    
    <script>
        {# Esto permite que al cargar el modal, se carga el form de stripe con los datos de la tarjeta #}
        $(document).ready(function(){
            $('direccion_state').select2();
            direccionId= $('#selectDirecciones').val();   
            tarjetaId= $('#selectTarjetas').val();
            console.log(direccionId + '-' + tarjetaId);
            buscar(direccionId,tarjetaId);


            $('#selectTarjetas').on('change',function(){
                var idTar=$(this).val();
                var idDir=$('#selectDirecciones').val();
                if(idTar==0){
                    $('#formnewcard').show();
                }
                else{

                    $('#tarjeta_numero').val('');
                    $('#tarjeta_nombre').val('');
                    $('#tarjeta_cvc').val('');
                    $('#tarjeta_expiracion').val('');

                    $('#opcionguardarcard').prop('checked',false);

                    $('#formnewcard').hide();
                }
                $('#stripe_view_address_new_address').val(idDir);
                $('#stripe_view_card_new_card').val(idTar);
            });

            $('#promoCode').on('click',function(){
                return false;
            });
            $('#selectDirecciones').on('change',function(){
                var idDir=$(this).val();
                var idTar=$('#selectTarjetas').val();
                if(idDir==0){
                    $('#formnewaddress').show();
                }
                else{

                    $('#direccion_name').val('');
                    $('#direccion_phoneNumber').val('');
                    $('#direccion_linea1').val('');
                    $('#direccion_linea2').val('');

                    $('#direccion_city').val('');
                    $('#direccion_state').val('');
                    $('#direccion_country').val('');


                    $('#direccion_zipCode').val('');
                    $('#direccion_securityAccessCode').val('');

                    $('#opcionguardaraddress').prop('checked',false);

                    $('#formnewaddress').hide();
                }
                $('#stripe_view_address_new_address').val(idDir);
                $('#stripe_view_card_new_card').val(idTar);

            });

            if($('#selectDirecciones').val()==0){
                $('#formnewaddress').show();    
                $('#stripe_view_address_new_address').val($('#selectDirecciones').val());
            }

            if($('#selectTarjetas').val()==0){
                $('#formnewcard').show();
                $('#stripe_view_card_new_card').val($('#selectTarjetas').val());
            }
    {#        $('#formCheckout').hide();#}

            $('#stripe_view_card_new_card').hide();
            $('#stripe_view_address_new_address').hide();
            $('#stripe_view_credit_cart').hide();
            $('#stripe_view_credit_cart_security').hide();
            $('#stripe_view_credit_cart_expiration_month').hide();
            $('#stripe_view_credit_cart_expiration_year').hide();
            $('#payment-submit').addClass('btn btn-success');
            $('#stripe_view_amount').val({{totalOrden*100}});
            $('#stripe_view_order').val({{ordenId}});


    {#      Campos de direccion  #}
            $(document).on('input','#direccion_name',function(){
                var num = $(this).val();
                $('#stripe_view_address_full_name').val(num);
                $('#direccion_name').removeClass('error');
            });

            $(document).on('input','#direccion_phoneNumber',function(){
                var num = $(this).val();
                $('#stripe_view_address_phone_number').val(num);
                $('#direccion_phoneNumber').removeClass('error');

            });

            $(document).on('input','#direccion_linea1',function(){
                var num = $(this).val();
                $('#stripe_view_address_line1').val(num);
                $('#direccion_linea1').removeClass('error');
            });

            $(document).on('input','#direccion_linea2',function(){
                var num = $(this).val();
                $('#stripe_view_address_line2').val(num);
                $('#direccion_linea2').removeClass('error');
            });

            $(document).on('input','#direccion_city',function(){
                var num = $(this).val();
                $('#stripe_view_address_city').val(num);
                $('#direccion_city').removeClass('error');
            });

            $(document).on('change','#direccion_state',function(){
                var num = $(this).val();
                $('#stripe_view_address_region').val(num);
                $('#direccion_state').removeClass('error');
            });

            $(document).on('change','#direccion_country',function(){
                var num = $(this).val();
                $('#stripe_view_address_country').val(num);

            });

            $(document).on('input','#direccion_zipCode',function(){
                var num = $(this).val();
                $('#stripe_view_address_zip_code').val(num);

            });

            $(document).on('input','#direccion_securityAccessCode',function(){
                var num = $(this).val();
                $('#stripe_view_address_security_code').val(num);
            });

            $(document).on('click','#opcionguardaraddress',function(){
                var num = $(this).is(':checked');
                $('#stripe_view_address_save_address').prop('checked',num);
            });


            $(document).on('click','#opcionguardarcard',function(){
                var num = $(this).is(':checked');
                $('#stripe_view_card_save_card').prop('checked',num);
            });

            $('#stripe_view_address_full_name').hide();
            $('#stripe_view_address_phone_number').hide();
            $('#stripe_view_address_full_name').hide();
            $('#stripe_view_address_line1').hide();
            $('#stripe_view_address_line2').hide();
            $('#stripe_view_address_city').hide();
            $('#stripe_view_address_region').val($('#direccion_state').val());
            $('#stripe_view_address_region').hide();
            $('#stripe_view_address_country').val($('#direccion_country').val());
            $('#stripe_view_address_country').hide();
            $('#stripe_view_address_security_code').hide();
            $('#stripe_view_address_zip_code').hide();
            $('#stripe_view_address_save_address').hide();

    {#      Campos de pago  #}
            $(document).on('input','#tarjeta_numero',function(){
                var num = $(this).val();
                $('#stripe_view_card_number').val(num);
                $('#stripe_view_credit_cart').val(num);
            });

            $(document).on('input','#tarjeta_nombre',function(){
                var num = $(this).val();
                $('#stripe_view_card_full_name').val(num);
            });

            $(document).on('input','#tarjeta_cvc',function(){
                var cvc = $(this).val();
                $('#stripe_view_card_cvc').val(cvc);
                $('#stripe_view_credit_cart_security').val(cvc);
            });
            $('#stripe_view_card_full_name').hide(); 
            $('#stripe_view_card_number').hide(); 
            $('#stripe_view_card_cvc').hide(); 
            $('#stripe_view_card_fecha').hide();

            $('#stripe_view_card_save_card').hide();

            //$('#formnewcard').hide();
            //$('#formnewaddress').hide();

            $('#payment-submit').on('click', function(){
                var error=0;
                if(
                    $('#selectDirecciones').val()==0 && ($('#direccion_name').val()=='' || $('#direccion_phoneNumber').val()==''
                    || $('#direccion_linea1').val()=='' || $('#direccion_linea2').val()=='' || $('#direccion_city').val()==''
                    || $('#direccion_state').val()=='' || $('#direccion_country').val()=='' || $('#direccion_zipCode').val()=='' )){

                    $('#direccion_name').addClass('error');
                    $('#direccion_phoneNumber').addClass('error');
                    $('#direccion_linea1').addClass('error');
                    $('#direccion_linea2').addClass('error');
                    $('#direccion_city').addClass('error');
                    $('#direccion_state').addClass('error');
                    $('#direccion_country').addClass('error');
                    $('#direccion_zipCode').addClass('error');

                    error++;
                }
                if($('#selectTarjetas').val()==0 && ($('#tarjeta_numero').val()=='' || $('#tarjeta_nombre').val()==''
                        || $('#tarjeta_cvc').val()=='' || $('#tarjeta_expiracion').val()=='')){
                    //alert();
                    $('#tarjeta_numero').addClass('error');
                    $('#tarjeta_nombre').addClass('error');
                    $('#tarjeta_cvc').addClass('error');
                    $('#tarjeta_expiracion').addClass('error');

                    error++;
                }
                if(error!=0){
                    return false;
                }
            });

            var codigo = $('#promo').val();

            if(codigo===''){
                    $('#promoCode').hide();
                }
                else{
                    $('#promoCode').show();
                    $(this).val(codigo.toUpperCase());
                }

            $('#promo').on('keyup',function(){
                capaError.style.visibility="hidden";
                codigo = $(this).val();
                if(codigo===''){
                    $('#promoCode').hide();
                }
                else{
                    $('#promoCode').show();
                    $(this).val(codigo.toUpperCase());

                }
            });
            var totalSinPromo = $('#total').val();

            $('#promoCode').on('click', function(){
                $('#total').val(totalSinPromo);
                $('#stripe_view_amount').val(totalSinPromo);
                $('#promoCode').prop('disabled',true);
                var promocion = $("#promo").val();
                var ordenId = {{ordenId}};
                //alert('prueba');
                $.ajax({
                  url:"{{path('valida_promocion')}}",
                  type: "POST",
                  data: { promocion:promocion, ordenId:ordenId },
    {#              data:{ promocion:""+$("#promo").val(),ordenId:""+{{ordenId}} },#}
                  success: function(respuesta){
                      if(respuesta.msj !== ""){
                          //document.getElementById("promo").className = "form-group has-error col-md-8 col-sm-8";
                          capaError.innerHTML=respuesta.msj;
                          capaError.style.visibility="visible";
                          //$("#code_promo").select();
                          $("#promo").focus();
                          $('#promoCode').prop('disabled',false);
                      }     
                      else{
                          //document.getElementById("promo").className = "col-md-8 col-sm-8";
                          capaError.style.visibility="hidden";
                          //alert(respuesta.porcentaje);
                          var total=totalSinPromo - ($('#total').val()*respuesta.porcentaje)/100;

                          $('#total').val(total.toFixed(2));
                          $('#stripe_view_amount').val(total.toFixed(2)*100);
                        }
                        $('#promoCode').prop('disabled',false); 
                    }
                });
                return false;
            });

        });
    </script>
{% endblock %}
